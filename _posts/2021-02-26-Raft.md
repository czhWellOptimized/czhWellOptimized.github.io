---
layout: post
title: Raft

tags: [distributed system]
---

## leader election(Section 5.2)

### how to start an election?

If a follower doesn't receive communication over the election timeout, it begins an election. 

The follower increments its current term and transitions to candidate state. It votes for itself and issues RequestVote RPCs to other servers in the cluster. A candidate continues in this state until one of three things happens: (a) it wins the election, (b) another server establishes itself as leader, or (c) a period of time goes by with no winner. 

Once a candidate wins an election, it becomes leader. It then sends heartbeat messages to all of the other servers to establish its authority and prevent new elections. 

### when a candidate receive an AppendEntries RPC from another server claiming to be leader, what does it do?

 If the leader’s term (included in its RPC) is at least as large as the candidate’s current term, then the candidate recognizes the leader as legitimate and returns to follower state. 

If the term in the RPC is smaller than the candidate’s current term, then the candidate rejects the RPC and continues in candidate state. 

 Raft uses randomized election timeouts to ensure that split votes are rare and that they are resolved quickly.

## log replication (Section 5.3)

 A log entry is committed once the leader that created the entry has replicated it on a majority of the servers (e.g., entry 7 in Figure 6). This also commits all preceding entries in the leader’s log, including entries created by previous leaders. 

how to determines which of two logs is more up-to-date:

- If the logs have last entries with different terms, then the log with the later term is more up-to-date. 
- If the logs end with the same term, then whichever log is longer is more up-to-date. 

 When sending an AppendEntries RPC, the leader includes the index and term of the entry in its log that immediately precedes the new entries. If the follower does not find an entry in its log with the same index and term, then it refuses the new entries. 

 After a rejection, the leader decrements nextIndex and retries the AppendEntries RPC. Eventually nextIndex will reach a point where the leader and follower logs match. 

## safety(Section 5.2,5.4) 

membership changes