---
layout: post
title: Redis设计与实现小结
tags: [database]
---

第一部分 数据结构与对象

1.quicklist



第二部分 单机数据库的实现

AOF：写命令。

AOF文件重写的实现：

Reactor模式（见《Linux高性能服务器开发》）

问：为什么时间时间要放在文件事件之后运行



第三部分 多机数据库的实现（重点总算来了！一致性等等）

部分重同步的实现

* 主服务器的复制偏移量（replication offset）和从服务器的复制偏移量。

  

* 主服务器的复制积压缓冲区（replication backlog）。

  

* 服务器的运行ID（run ID）。

REPLCONF ACK：类似计算机网络中的ACK。



Sentinel系统（有点精彩了，涉及到epoch、选举，这个需要好好总结）

这里选的是sentinel的leader，而不是server的leader。所以sentinel其实就是协调者。选出sentinel的leader只是为了处理下线的server的故障，毕竟监视着下线server的sentinel不止一个，不可能每个都来处理故障。看到最后发现就是类似Raft的实现。

1.先到先得

2.其它和Raft选举相似

这里就是它和Raft选举的区别，Raft选举的election timeout一般不同，所以很少出现选不出leader的情况。不知道redis中是如何处理这个问题的？

Make sure the election timeouts in different peers don't always fire at the same time, or else all peers will vote only for themselves and no one will become the leader.

第四部分 独立功能的实现

WATCH乐观锁：对应的隔离级别是可串行化的快照隔离吗？



子进程：

1.BGSAVE

2.AOF后台重写

